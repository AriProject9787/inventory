<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cake Shop Billing Software</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fffaf5;
      display: flex;
      color: #333;
    }
    .sidebar {
      width: 240px;
      background: #6a0d0d;
      color: white;
      height: 100vh;
      padding-top: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5em;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .sidebar li:hover {
      background: #8b0000;
    }
    .container {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    h1 {
      text-align: center;
      color: #8B0000;
    }
    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: center;
    }
    #totalAmount {
      font-size: 22px;
      margin-top: 20px;
      font-weight: bold;
      text-align: right;
    }
    button {
      background-color: #8B0000;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    button:hover {
      background-color: #a30000;
    }
    .custom-section {
      display: none;
      border-top: 2px solid #8b0000;
      margin-top: 30px;
      padding-top: 20px;
    }
    .actions {
      margin-top: 20px;
    }

    /* Print Styles for RP3150 (72mm width) */
    @media print {
      @page {
        size: 72mm auto;
        margin: 5mm;
      }
      body {
        font-size: 10px;
        font-family: 'Courier New', monospace;
        margin: 0;
      }
      .sidebar, .container {
        display: none;
      }
      #printArea {
        display: block;
        width: 100%;
      }
      .print-header {
        text-align: center;
        margin-bottom: 10px;
      }
      .print-table {
        width: 100%;
        border-collapse: collapse;
      }
      .print-table th, .print-table td {
        text-align: left;
        padding: 4px 0;
        font-size: 10px;
      }
      .print-footer {
        text-align: center;
        margin-top: 10px;
        border-top: 1px dashed #000;
        padding-top: 5px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Categories</h2>
    <ul>
      <li onclick="filterCategory('Fresh Cream Cakes')">Fresh Cream Cakes</li>
      <li onclick="filterCategory('Pizza')">Pizza</li>
      <li onclick="filterCategory('Sandwiches')">Sandwiches</li>
      <li onclick="filterCategory('Desserts')">Desserts</li>
      <li onclick="filterCategory('Milkshakes')">Milkshakes</li>
      <li onclick="filterCategory('Pastry Cakes')">Pastry Cakes</li>
      <li onclick="filterCategory('All')">Show All</li>
      <li onclick="filterCategory('Custom')">Custom Cakes</li>
    </ul>
  </div>

  <div class="container">
    <h1>Cake Shop Billing</h1>

    <label for="item">Select Item:</label>
    <select id="item"><option value="">--Choose--</option></select>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" min="1" value="1"/>

    <div class="custom-section" id="customSection">
      <h3>Add Custom Cake</h3>
      <label for="customItemName">Item Name:</label>
      <input type="text" id="customItemName" placeholder="e.g., Special Chocolate Cake"/>
      <label for="customItemPrice">Unit Price (₹):</label>
      <input type="number" id="customItemPrice" min="1" placeholder="e.g., 350"/>
    </div>

    <div class="actions">
      <button onclick="addItem()">Add to Bill</button>
      <button onclick="addCustomItem()">Add Custom Item</button>
      <button onclick="printBill()">Print Bill</button>
      <button onclick="exportCSV()">Export CSV</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody id="billTable"></tbody>
    </table>

    <div id="totalAmount">Total: ₹0</div>

    <div id="dailyReport" style="margin-top: 40px; border-top: 2px solid #8B0000; padding-top: 20px;">
      <h3>Today's Sales Report</h3>
      <div id="todaySalesTotal">Total Sales Today: ₹0</div>
    </div>
  </div>

  <!-- Printable 72mm Invoice Format -->
  <div id="printArea" style="display:none;">
    <div class="print-header">
      <strong>BROWNIE FACTORY</strong><br/>
      GSTIN: 33AMCPR6223Q2ZN<br/>
      Ph: 044-26862877<br/>
      212, Redhills Main Rd, Ambattur, Chennai-600053
    </div>
    <table class="print-table" id="printTable"></table>
    <div class="print-footer">
      Total: ₹<span id="printTotal">0</span><br/>
      Thank you. Visit Again!
    </div>
  </div>

  <script>
    const allItems = {
      "Fresh Cream Cakes": { "Vanilla Delight 0.5kg": 280, "Black Forest 1kg": 600, "Choco Truffle 0.5kg": 450 },
      "Pizza": { "Paneer Pizza": 220, "Chilli Chicken Pizza": 260, "Cheese Pizza": 160 },
      "Sandwiches": { "American Fresh Chicken Sandwich": 140, "Chicken Cheese Sandwich": 100 },
      "Desserts": { "Chocolate Brownie with Ice Cream": 90 },
      "Milkshakes": { "Strawberry Milkshake": 100 },
      "Pastry Cakes": { "Chocolate Truffle Pastry": 70 }
    };

    let grandTotal = 0;
    const itemSelect = document.getElementById("item");
    const customSection = document.getElementById("customSection");

    function populateItems(category) {
      itemSelect.innerHTML = '<option value="">--Choose--</option>';
      if (category === 'Custom') {
        customSection.style.display = 'block';
        return;
      } else {
        customSection.style.display = 'none';
      }

      const categories = category === 'All' ? allItems : { [category]: allItems[category] };
      for (const [cat, items] of Object.entries(categories)) {
        for (const [name, price] of Object.entries(items)) {
          const option = document.createElement("option");
          option.value = name;
          option.textContent = `${name} - ₹${price}`;
          itemSelect.appendChild(option);
        }
      }
    }

    function filterCategory(category) {
      populateItems(category);
    }

    function saveSale(itemName, unitPrice, quantity, total) {
      const today = new Date().toLocaleDateString();
      const sales = JSON.parse(localStorage.getItem("sales")) || [];
      sales.push({ date: today, item: itemName, unitPrice, quantity, total });
      localStorage.setItem("sales", JSON.stringify(sales));
    }

    function addItem() {
      const itemName = itemSelect.value;
      const quantity = parseInt(document.getElementById("quantity").value);
      if (!itemName || quantity <= 0) {
        alert("Please select a valid item and quantity.");
        return;
      }

      let itemPrice = 0;
      for (const catItems of Object.values(allItems)) {
        if (itemName in catItems) {
          itemPrice = catItems[itemName];
          break;
        }
      }

      const total = itemPrice * quantity;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${itemName}</td>
        <td>₹${itemPrice}</td>
        <td>${quantity}</td>
        <td>₹${total}</td>
        <td><button onclick="removeItem(this, ${total})">Remove</button></td>
      `;
      document.getElementById("billTable").appendChild(row);
      updateTotal(total);
      saveSale(itemName, itemPrice, quantity, total);
      calculateTodaySales();
      itemSelect.value = "";
      document.getElementById("quantity").value = 1;
    }

    function addCustomItem() {
      const customName = document.getElementById("customItemName").value.trim();
      const customPrice = parseFloat(document.getElementById("customItemPrice").value);
      const quantity = parseInt(document.getElementById("quantity").value);

      if (!customName || isNaN(customPrice) || customPrice <= 0 || quantity <= 0) {
        alert("Please enter valid custom item details and quantity.");
        return;
      }

      const total = customPrice * quantity;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${customName}</td>
        <td>₹${customPrice}</td>
        <td>${quantity}</td>
        <td>₹${total}</td>
        <td><button onclick="removeItem(this, ${total})">Remove</button></td>
      `;
      document.getElementById("billTable").appendChild(row);
      updateTotal(total);
      saveSale(customName, customPrice, quantity, total);
      calculateTodaySales();
      document.getElementById("customItemName").value = "";
      document.getElementById("customItemPrice").value = "";
    }

    function updateTotal(amount) {
      grandTotal += amount;
      document.getElementById("totalAmount").textContent = `Total: ₹${grandTotal}`;
    }

    function removeItem(button, amount) {
      const row = button.parentElement.parentElement;
      row.remove();
      grandTotal -= amount;
      document.getElementById("totalAmount").textContent = `Total: ₹${grandTotal}`;
    }

    function calculateTodaySales() {
      const today = new Date().toLocaleDateString();
      const sales = JSON.parse(localStorage.getItem("sales")) || [];
      const todaySales = sales.filter(sale => sale.date === today);
      const total = todaySales.reduce((sum, sale) => sum + sale.total, 0);
      document.getElementById("todaySalesTotal").textContent = `Total Sales Today: ₹${total}`;
    }

    function printBill() {
      const table = document.getElementById("billTable");
      const printTable = document.getElementById("printTable");
      printTable.innerHTML = "";

      const headerRow = document.createElement("tr");
      headerRow.innerHTML = `
        <th>Item</th><th>Qty</th><th>Rate</th><th>Amt</th>
      `;
      printTable.appendChild(headerRow);

      for (const row of table.rows) {
        const cells = row.querySelectorAll("td");
        if (cells.length === 5) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${cells[0].innerText}</td>
            <td>${cells[2].innerText}</td>
            <td>${cells[1].innerText.replace('₹','')}</td>
            <td>${cells[3].innerText.replace('₹','')}</td>
          `;
          printTable.appendChild(tr);
        }
      }

      document.getElementById("printTotal").innerText = grandTotal;

      const printContent = document.getElementById("printArea").outerHTML;
      const originalContent = document.body.innerHTML;
      document.body.innerHTML = printContent;
      window.print();
      document.body.innerHTML = originalContent;
      window.location.reload();
    }

    function exportCSV() {
      const table = document.getElementById("billTable");
      let csv = "Item,Unit Price,Quantity,Total\n";
      for (const row of table.rows) {
        const cells = row.querySelectorAll("td");
        if (cells.length === 5) {
          csv += `${cells[0].innerText},${cells[1].innerText},${cells[2].innerText},${cells[3].innerText}\n`;
        }
      }
      csv += `,,,Total: ₹${grandTotal}`;

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", "CakeShop_Bill.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    window.onload = () => {
      populateItems("All");
      calculateTodaySales();
    };
  </script>
</body>
</html>
